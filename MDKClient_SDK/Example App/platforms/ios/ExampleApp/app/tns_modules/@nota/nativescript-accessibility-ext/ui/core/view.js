"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var profiling_1 = require("@nativescript/core/profiling");
var view_1 = require("@nativescript/core/ui/core/view");
var trace_1 = require("../../trace");
var AccessibilityHelper_1 = require("../../utils/AccessibilityHelper");
var helpers_1 = require("../../utils/helpers");
var view_common_1 = require("./view-common");
var updateA11YProperty = profiling_1.profile('updateA11YProperty', function updateA11YPropertyImpl(tnsView, propName, value) {
    var cls = "View<" + tnsView + ".ios>." + propName + " = " + value;
    var uiView = AccessibilityHelper_1.getUIView(tnsView);
    if (!uiView) {
        if (trace_1.isTraceEnabled()) {
            trace_1.writeTrace(cls + " - no nativeView");
        }
        return;
    }
    value = value != null ? "" + value : null;
    if (trace_1.isTraceEnabled()) {
        trace_1.writeTrace("" + cls);
    }
    uiView[propName] = value;
});
view_1.View.prototype[view_common_1.accessibleCssProperty.setNative] = profiling_1.profile('View<A11Y>.accessibleSetNative', function accessibleSetNative(isAccessible) {
    var uiView = AccessibilityHelper_1.getUIView(this);
    if (!uiView) {
        return;
    }
    uiView.isAccessibilityElement = !!isAccessible;
    if (trace_1.isTraceEnabled()) {
        trace_1.writeTrace("View<" + this + ".ios>.accessible = " + uiView.isAccessibilityElement);
    }
    AccessibilityHelper_1.AccessibilityHelper.updateAccessibilityProperties(this);
});
view_1.View.prototype[view_common_1.accessibilityRoleCssProperty.setNative] = profiling_1.profile('View<A11Y>.accessibilityComponentTypeSetNative', function accessibilityComponentTypeSetNative() {
    AccessibilityHelper_1.AccessibilityHelper.updateAccessibilityProperties(this);
});
view_1.View.prototype[view_common_1.accessibilityTraitsProperty.setNative] = profiling_1.profile('View<A11Y>.accessibilityTraitsSetNative', function accessibilityTraitsSetNative() {
    AccessibilityHelper_1.AccessibilityHelper.updateAccessibilityProperties(this);
});
view_1.View.prototype[view_common_1.accessibilityValueProperty.setNative] = profiling_1.profile('View<A11Y>.accessibilityValueSetNative', function accessibilityValueSetNative(value) {
    updateA11YProperty(this, 'accessibilityValue', value);
});
view_1.View.prototype[view_common_1.accessibilityHiddenCssProperty.setNative] = profiling_1.profile('View<A11Y>.accessibilityElementsHiddenSetNative', function accessibilityElementsHiddenSetNative(isHidden) {
    var uiView = AccessibilityHelper_1.getUIView(this);
    if (!uiView) {
        return;
    }
    uiView.accessibilityElementsHidden = !!isHidden;
    if (trace_1.isTraceEnabled()) {
        trace_1.writeTrace("View<" + this + ".ios>.accessibilityElementsHidden - " + !!isHidden);
    }
    AccessibilityHelper_1.AccessibilityHelper.updateAccessibilityProperties(this);
});
view_1.View.prototype[view_common_1.accessibilityLiveRegionCssProperty.setNative] = profiling_1.profile('View<A11Y>.accessibilityLiveRegionSetNative', function accessibilityLiveRegionSetNative() {
    AccessibilityHelper_1.AccessibilityHelper.updateAccessibilityProperties(this);
});
view_1.View.prototype[view_common_1.accessibilityStateCssProperty.setNative] = profiling_1.profile('View<A11Y>.accessibilityStateSetNative', function accessibilityStateSetNative() {
    AccessibilityHelper_1.AccessibilityHelper.updateAccessibilityProperties(this);
});
helpers_1.setViewFunction(view_1.View, view_common_1.iosFunctions.iosPostAccessibilityNotification, profiling_1.profile('View<A11Y>.iosPostAccessibilityNotification', function postAccessibilityNotification(notificationType, msg) {
    var cls = "View<" + this + ".ios>.postAccessibilityNotification(\"" + notificationType + "\", \"" + msg + "\")";
    if (!notificationType) {
        if (trace_1.isTraceEnabled()) {
            trace_1.writeTrace(cls + " - falsy notificationType");
        }
        return;
    }
    var notification;
    var args = AccessibilityHelper_1.getUIView(this);
    if (typeof msg === 'string' && msg) {
        args = msg;
    }
    switch (notificationType.toLowerCase()) {
        case 'announcement': {
            notification = UIAccessibilityAnnouncementNotification;
            break;
        }
        case 'layout': {
            notification = UIAccessibilityLayoutChangedNotification;
            break;
        }
        case 'screen': {
            notification = UIAccessibilityScreenChangedNotification;
            break;
        }
        default: {
            if (trace_1.isTraceEnabled()) {
                trace_1.writeTrace(cls + " - unknown notificationType");
            }
            return;
        }
    }
    if (trace_1.isTraceEnabled()) {
        trace_1.writeTrace(cls + " - send " + notification + " with " + (args || null));
    }
    UIAccessibilityPostNotification(notification, args || null);
}));
helpers_1.setViewFunction(view_1.View, view_common_1.commonFunctions.accessibilityAnnouncement, profiling_1.profile('View<A11Y>.accessibilityAnnouncement', function accessibilityAnnouncement(msg) {
    var cls = "View<" + this + ".ios>.accessibilityAnnouncement(\"" + msg + "\")";
    if (!msg) {
        if (trace_1.isTraceEnabled()) {
            trace_1.writeTrace(cls + " - no msg, sending view.accessibilityLabel = " + this.accessibilityLabel + " instead");
        }
        msg = this.accessibilityLabel;
    }
    if (trace_1.isTraceEnabled()) {
        trace_1.writeTrace(cls + " - sending " + msg);
    }
    this.iosPostAccessibilityNotification('announcement', msg);
}));
view_1.View.prototype[view_common_1.accessibilityLabelProperty.setNative] = profiling_1.profile('View<A11Y>.accessibilityLabelSetNative', function accessibilityLabelSetNative(label) {
    updateA11YProperty(this, 'accessibilityLabel', label);
});
view_1.View.prototype[view_common_1.accessibilityIdProperty.setNative] = profiling_1.profile('View<A11Y>.accessibilityIdentifierSetNative', function accessibilityIdentifierSetNative(identifier) {
    updateA11YProperty(this, 'accessibilityIdentifier', identifier);
});
view_1.View.prototype[view_common_1.accessibilityLanguageProperty.setNative] = profiling_1.profile('View<A11Y>.accessibilityLanguageSetNative', function accessibilityLanguageSetNative(lang) {
    updateA11YProperty(this, 'accessibilityLanguage', lang);
});
view_1.View.prototype[view_common_1.accessibilityHintProperty.setNative] = profiling_1.profile('View<A11Y>.accessibilityHintSetNative', function accessibilityHintSetNative(hint) {
    updateA11YProperty(this, 'accessibilityHint', hint);
});
view_1.View.prototype[view_common_1.accessibilityMediaSessionCssProperty.setNative] = profiling_1.profile('View<A11Y>.accessibilityMediaSessionSetNative', function accessibilityMediaSessionSetNative() {
    AccessibilityHelper_1.AccessibilityHelper.updateAccessibilityProperties(this);
});
helpers_1.setViewFunction(view_1.View, view_common_1.commonFunctions.accessibilityScreenChanged, profiling_1.profile('View<A11Y>..accessibilityScreenChanged', function accessibilityScreenChanged() {
    this.iosPostAccessibilityNotification('screen');
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy5pb3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ2aWV3Lmlvcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLDBEQUF1RDtBQUN2RCx3REFBMEY7QUFDMUYscUNBQXlEO0FBQ3pELHVFQUFpRjtBQUNqRiwrQ0FBc0Q7QUFDdEQsNkNBZXVCO0FBRXZCLElBQU0sa0JBQWtCLEdBQUcsbUJBQU8sQ0FBQyxvQkFBb0IsRUFBRSxTQUFTLHNCQUFzQixDQUFDLE9BQWEsRUFBRSxRQUFnQixFQUFFLEtBQW9CO0lBQzVJLElBQU0sR0FBRyxHQUFHLFVBQVEsT0FBTyxjQUFTLFFBQVEsV0FBTSxLQUFPLENBQUM7SUFDMUQsSUFBTSxNQUFNLEdBQUcsK0JBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNsQyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQ1gsSUFBSSxzQkFBYyxFQUFFLEVBQUU7WUFDcEIsa0JBQVUsQ0FBSSxHQUFHLHFCQUFrQixDQUFDLENBQUM7U0FDdEM7UUFFRCxPQUFPO0tBQ1I7SUFFRCxLQUFLLEdBQUcsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBRyxLQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUMxQyxJQUFJLHNCQUFjLEVBQUUsRUFBRTtRQUNwQixrQkFBVSxDQUFDLEtBQUcsR0FBSyxDQUFDLENBQUM7S0FDdEI7SUFFRCxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsS0FBSyxDQUFDO0FBQzNCLENBQUMsQ0FBQyxDQUFDO0FBRUgsV0FBSSxDQUFDLFNBQVMsQ0FBQyxtQ0FBcUIsQ0FBQyxTQUFTLENBQUMsR0FBRyxtQkFBTyxDQUFDLGdDQUFnQyxFQUFFLFNBQVMsbUJBQW1CLENBQWEsWUFBcUI7SUFDeEosSUFBTSxNQUFNLEdBQUcsK0JBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvQixJQUFJLENBQUMsTUFBTSxFQUFFO1FBQ1gsT0FBTztLQUNSO0lBRUQsTUFBTSxDQUFDLHNCQUFz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LENBQUMsSUFBSSxDQUFDLENBQUM7QUFDMUQsQ0FBQyxDQUNGLENBQUM7QUFFRix5QkFBZSxDQUNiLFdBQUksRUFDSiw2QkFBZSxDQUFDLDBCQUEwQixFQUMxQyxtQkFBTyxDQUFDLHdDQUF3QyxFQUFFLFNBQVMsMEJBQTBCO0lBQ25GLElBQUksQ0FBQyxnQ0FBZ0MsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNsRCxDQUFDLENBQUMsQ0FDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vdmlldy5kLnRzXCIgLz5cblxuaW1wb3J0IHsgcHJvZmlsZSB9IGZyb20gJ0BuYXRpdmVzY3JpcHQvY29yZS9wcm9maWxpbmcnO1xuaW1wb3J0IHsgUG9zdEFjY2Vzc2liaWxpdHlOb3RpZmljYXRpb25UeXBlLCBWaWV3IH0gZnJvbSAnQG5hdGl2ZXNjcmlwdC9jb3JlL3VpL2NvcmUvdmlldyc7XG5pbXBvcnQgeyBpc1RyYWNlRW5hYmxlZCwgd3JpdGVUcmFjZSB9IGZyb20gJy4uLy4uL3RyYWNlJztcbmltcG9ydCB7IEFjY2Vzc2liaWxpdHlIZWxwZXIsIGdldFVJVmlldyB9IGZyb20gJy4uLy4uL3V0aWxzL0FjY2Vzc2liaWxpdHlIZWxwZXInO1xuaW1wb3J0IHsgc2V0Vmlld0Z1bmN0aW9uIH0gZnJvbSAnLi4vLi4vdXRpbHMvaGVscGVycyc7XG5pbXBvcnQge1xuICBhY2Nlc3NpYmlsaXR5SGlkZGVuQ3NzUHJvcGVydHksXG4gIGFjY2Vzc2liaWxpdHlIaW50UHJvcGVydHksXG4gIGFjY2Vzc2liaWxpdHlJZFByb3BlcnR5LFxuICBhY2Nlc3NpYmlsaXR5TGFiZWxQcm9wZXJ0eSxcbiAgYWNjZXNzaWJpbGl0eUxhbmd1YWdlUHJvcGVydHksXG4gIGFjY2Vzc2liaWxpdHlMaXZlUmVnaW9uQ3NzUHJvcGVydHksXG4gIGFjY2Vzc2liaWxpdHlNZWRpYVNlc3Npb25Dc3NQcm9wZXJ0eSxcbiAgYWNjZXNzaWJpbGl0eVJvbGVDc3NQcm9wZXJ0eSxcbiAgYWNjZXNzaWJpbGl0eVN0YXRlQ3NzUHJvcGVydHksXG4gIGFjY2Vzc2liaWxpdHlUcmFpdHNQcm9wZXJ0eSxcbiAgYWNjZXNzaWJpbGl0eVZhbHVlUHJvcGVydHksXG4gIGFjY2Vzc2libGVDc3NQcm9wZXJ0eSxcbiAgY29tbW9uRnVuY3Rpb25zLFxuICBpb3NGdW5jdGlvbnMsXG59IGZyb20gJy4vdmlldy1jb21tb24nO1xuXG5jb25zdCB1cGRhdGVBMTFZUHJvcGVydHkgPSBwcm9maWxlKCd1cGRhdGVBMTFZUHJvcGVydHknLCBmdW5jdGlvbiB1cGRhdGVBMTFZUHJvcGVydHlJbXBsKHRuc1ZpZXc6IFZpZXcsIHByb3BOYW1lOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBudWxsKSB7XG4gIGNvbnN0IGNscyA9IGBWaWV3PCR7dG5zVmlld30uaW9zPi4ke3Byb3BOYW1lfSA9ICR7dmFsdWV9YDtcbiAgY29uc3QgdWlWaWV3ID0gZ2V0VUlWaWV3KHRuc1ZpZXcpO1xuICBpZiAoIXVpVmlldykge1xuICAgIGlmIChpc1RyYWNlRW5hYmxlZCgpKSB7XG4gICAgICB3cml0ZVRyYWNlKGAke2Nsc30gLSBubyBuYXRpdmVWaWV3YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFsdWUgPSB2YWx1ZSAhPSBudWxsID8gYCR7dmFsdWV9YCA6IG51bGw7XG4gIGlmIChpc1RyYWNlRW5hYmxlZCgpKSB7XG4gICAgd3JpdGVUcmFjZShgJHtjbHN9YCk7XG4gIH1cblxuICB1aVZpZXdbcHJvcE5hbWVdID0gdmFsdWU7XG59KTtcblxuVmlldy5wcm90b3R5cGVbYWNjZXNzaWJsZUNzc1Byb3BlcnR5LnNldE5hdGl2ZV0gPSBwcm9maWxlKCdWaWV3PEExMVk+LmFjY2Vzc2libGVTZXROYXRpdmUnLCBmdW5jdGlvbiBhY2Nlc3NpYmxlU2V0TmF0aXZlKHRoaXM6IFZpZXcsIGlzQWNjZXNzaWJsZTogYm9vbGVhbikge1xuICBjb25zdCB1aVZpZXcgPSBnZXRVSVZpZXcodGhpcyk7XG4gIGlmICghdWlWaWV3KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdWlWaWV3LmlzQWNjZXNzaWJpbGl0eUVsZW1lbnQgPSAhIWlzQWNjZXNzaWJsZTtcblxuICBpZiAoaXNUcmFjZUVuYWJsZWQoKSkge1xuICAgIHdyaXRlVHJhY2UoYFZpZXc8JHt0aGlzfS5pb3M+LmFjY2Vzc2libGUgPSAke3VpVmlldy5pc0FjY2Vzc2liaWxpdHlFbGVtZW50fWApO1xuICB9XG5cbiAgQWNjZXNzaWJpbGl0eUhlbHBlci51cGRhdGVBY2Nlc3NpYmlsaXR5UHJvcGVydGllcyh0aGlzKTtcbn0pO1xuXG5WaWV3LnByb3RvdHlwZVthY2Nlc3NpYmlsaXR5Um9sZUNzc1Byb3BlcnR5LnNldE5hdGl2ZV0gPSBwcm9maWxlKCdWaWV3PEExMVk+LmFjY2Vzc2liaWxpdHlDb21wb25lbnRUeXBlU2V0TmF0aXZlJywgZnVuY3Rpb24gYWNjZXNzaWJpbGl0eUNvbXBvbmVudFR5cGVTZXROYXRpdmUoXG4gIHRoaXM6IFZpZXcsXG4pIHtcbiAgQWNjZXNzaWJpbGl0eUhlbHBlci51cGRhdGVBY2Nlc3NpYmlsaXR5UHJvcGVydGllcyh0aGlzKTtcbn0pO1xuXG5WaWV3LnByb3RvdHlwZVthY2Nlc3NpYmlsaXR5VHJhaXRzUHJvcGVydHkuc2V0TmF0aXZlXSA9IHByb2ZpbGUoJ1ZpZXc8QTExWT4uYWNjZXNzaWJpbGl0eVRyYWl0c1NldE5hdGl2ZScsIGZ1bmN0aW9uIGFjY2Vzc2liaWxpdHlUcmFpdHNTZXROYXRpdmUodGhpczogVmlldykge1xuICBBY2Nlc3NpYmlsaXR5SGVscGVyLnVwZGF0ZUFjY2Vzc2liaWxpdHlQcm9wZXJ0aWVzKHRoaXMpO1xufSk7XG5cblZpZXcucHJvdG90eXBlW2FjY2Vzc2liaWxpdHlWYWx1ZVByb3BlcnR5LnNldE5hdGl2ZV0gPSBwcm9maWxlKCdWaWV3PEExMVk+LmFjY2Vzc2liaWxpdHlWYWx1ZVNldE5hdGl2ZScsIGZ1bmN0aW9uIGFjY2Vzc2liaWxpdHlWYWx1ZVNldE5hdGl2ZShcbiAgdGhpczogVmlldyxcbiAgdmFsdWU6IHN0cmluZyxcbikge1xuICB1cGRhdGVBMTFZUHJvcGVydHkodGhpcywgJ2FjY2Vzc2liaWxpdHlWYWx1ZScsIHZhbHVlKTtcbn0pO1xuXG5WaWV3LnByb3RvdHlwZVthY2Nlc3NpYmlsaXR5SGlkZGVuQ3NzUHJvcGVydHkuc2V0TmF0aXZlXSA9IHByb2ZpbGUoXG4gICdWaWV3PEExMVk+LmFjY2Vzc2liaWxpdHlFbGVtZW50c0hpZGRlblNldE5hdGl2ZScsXG4gIGZ1bmN0aW9uIGFjY2Vzc2liaWxpdHlFbGVtZW50c0hpZGRlblNldE5hdGl2ZSh0aGlzOiBWaWV3LCBpc0hpZGRlbjogYm9vbGVhbikge1xuICAgIGNvbnN0IHVpVmlldyA9IGdldFVJVmlldyh0aGlzKTtcbiAgICBpZiAoIXVpVmlldykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHVpVmlldy5hY2Nlc3NpYmlsaXR5RWxlbWVudHNIaWRkZW4gPSAhIWlzSGlkZGVuO1xuICAgIGlmIChpc1RyYWNlRW5hYmxlZCgpKSB7XG4gICAgICB3cml0ZVRyYWNlKGBWaWV3PCR7dGhpc30uaW9zPi5hY2Nlc3NpYmlsaXR5RWxlbWVudHNIaWRkZW4gLSAkeyEhaXNIaWRkZW59YCk7XG4gICAgfVxuXG4gICAgQWNjZXNzaWJpbGl0eUhlbHBlci51cGRhdGVBY2Nlc3NpYmlsaXR5UHJvcGVydGllcyh0aGlzKTtcbiAgfSxcbik7XG5cblZpZXcucHJvdG90eXBlW2FjY2Vzc2liaWxpdHlMaXZlUmVnaW9uQ3NzUHJvcGVydHkuc2V0TmF0aXZlXSA9IHByb2ZpbGUoJ1ZpZXc8QTExWT4uYWNjZXNzaWJpbGl0eUxpdmVSZWdpb25TZXROYXRpdmUnLCBmdW5jdGlvbiBhY2Nlc3NpYmlsaXR5TGl2ZVJlZ2lvblNldE5hdGl2ZShcbiAgdGhpczogVmlldyxcbikge1xuICBBY2Nlc3NpYmlsaXR5SGVscGVyLnVwZGF0ZUFjY2Vzc2liaWxpdHlQcm9wZXJ0aWVzKHRoaXMpO1xufSk7XG5cblZpZXcucHJvdG90eXBlW2FjY2Vzc2liaWxpdHlTdGF0ZUNzc1Byb3BlcnR5LnNldE5hdGl2ZV0gPSBwcm9maWxlKCdWaWV3PEExMVk+LmFjY2Vzc2liaWxpdHlTdGF0ZVNldE5hdGl2ZScsIGZ1bmN0aW9uIGFjY2Vzc2liaWxpdHlTdGF0ZVNldE5hdGl2ZSh0aGlzOiBWaWV3KSB7XG4gIEFjY2Vzc2liaWxpdHlIZWxwZXIudXBkYXRlQWNjZXNzaWJpbGl0eVByb3BlcnRpZXModGhpcyk7XG59KTtcblxuc2V0Vmlld0Z1bmN0aW9uKFxuICBWaWV3LFxuICBpb3NGdW5jdGlvbnMuaW9zUG9zdEFjY2Vzc2liaWxpdHlOb3RpZmljYXRpb24sXG4gIHByb2ZpbGUoJ1ZpZXc8QTExWT4uaW9zUG9zdEFjY2Vzc2liaWxpdHlOb3RpZmljYXRpb24nLCBmdW5jdGlvbiBwb3N0QWNjZXNzaWJpbGl0eU5vdGlmaWNhdGlvbihcbiAgICB0aGlzOiBWaWV3LFxuICAgIG5vdGlmaWNhdGlvblR5cGU6IFBvc3RBY2Nlc3NpYmlsaXR5Tm90aWZpY2F0aW9uVHlwZSxcbiAgICBtc2c/OiBzdHJpbmcsXG4gICkge1xuICAgIGNvbnN0IGNscyA9IGBWaWV3PCR7dGhpc30uaW9zPi5wb3N0QWNjZXNzaWJpbGl0eU5vdGlmaWNhdGlvbihcIiR7bm90aWZpY2F0aW9uVHlwZX1cIiwgXCIke21zZ31cIilgO1xuICAgIGlmICghbm90aWZpY2F0aW9uVHlwZSkge1xuICAgICAgaWYgKGlzVHJhY2VFbmFibGVkKCkpIHtcbiAgICAgICAgd3JpdGVUcmFjZShgJHtjbHN9IC0gZmFsc3kgbm90aWZpY2F0aW9uVHlwZWApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IG5vdGlmaWNhdGlvbjogbnVtYmVyO1xuICAgIGxldCBhcmdzOiBzdHJpbmcgfCBVSVZpZXcgfCBudWxsID0gZ2V0VUlWaWV3KHRoaXMpO1xuICAgIGlmICh0eXBlb2YgbXNnID09PSAnc3RyaW5nJyAmJiBtc2cpIHtcbiAgICAgIGFyZ3MgPSBtc2c7XG4gICAgfVxuXG4gICAgc3dpdGNoIChub3RpZmljYXRpb25UeXBlLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgIGNhc2UgJ2Fubm91bmNlbWVudCc6IHtcbiAgICAgICAgbm90aWZpY2F0aW9uID0gVUlBY2Nlc3NpYmlsaXR5QW5ub3VuY2VtZW50Tm90aWZpY2F0aW9uO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgJ2xheW91dCc6IHtcbiAgICAgICAgbm90aWZpY2F0aW9uID0gVUlBY2Nlc3NpYmlsaXR5TGF5b3V0Q2hhbmdlZE5vdGlmaWNhdGlvbjtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlICdzY3JlZW4nOiB7XG4gICAgICAgIG5vdGlmaWNhdGlvbiA9IFVJQWNjZXNzaWJpbGl0eVNjcmVlbkNoYW5nZWROb3RpZmljYXRpb247XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBpZiAoaXNUcmFjZUVuYWJsZWQoKSkge1xuICAgICAgICAgIHdyaXRlVHJhY2UoYCR7Y2xzfSAtIHVua25vd24gbm90aWZpY2F0aW9uVHlwZWApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc1RyYWNlRW5hYmxlZCgpKSB7XG4gICAgICB3cml0ZVRyYWNlKGAke2Nsc30gLSBzZW5kICR7bm90aWZpY2F0aW9ufSB3aXRoICR7YXJncyB8fCBudWxsfWApO1xuICAgIH1cblxuICAgIFVJQWNjZXNzaWJpbGl0eVBvc3ROb3RpZmljYXRpb24obm90aWZpY2F0aW9uLCBhcmdzIHx8IG51bGwpO1xuICB9KSxcbik7XG5cbnNldFZpZXdGdW5jdGlvbihcbiAgVmlldyxcbiAgY29tbW9uRnVuY3Rpb25zLmFjY2Vzc2liaWxpdHlBbm5vdW5jZW1lbnQsXG4gIHByb2ZpbGUoJ1ZpZXc8QTExWT4uYWNjZXNzaWJpbGl0eUFubm91bmNlbWVudCcsIGZ1bmN0aW9uIGFjY2Vzc2liaWxpdHlBbm5vdW5jZW1lbnQodGhpczogVmlldywgbXNnPzogc3RyaW5nKSB7XG4gICAgY29uc3QgY2xzID0gYFZpZXc8JHt0aGlzfS5pb3M+LmFjY2Vzc2liaWxpdHlBbm5vdW5jZW1lbnQoXCIke21zZ31cIilgO1xuICAgIGlmICghbXNnKSB7XG4gICAgICBpZiAoaXNUcmFjZUVuYWJsZWQoKSkge1xuICAgICAgICB3cml0ZVRyYWNlKGAke2Nsc30gLSBubyBtc2csIHNlbmRpbmcgdmlldy5hY2Nlc3NpYmlsaXR5TGFiZWwgPSAke3RoaXMuYWNjZXNzaWJpbGl0eUxhYmVsfSBpbnN0ZWFkYCk7XG4gICAgICB9XG5cbiAgICAgIG1zZyA9IHRoaXMuYWNjZXNzaWJpbGl0eUxhYmVsO1xuICAgIH1cblxuICAgIGlmIChpc1RyYWNlRW5hYmxlZCgpKSB7XG4gICAgICB3cml0ZVRyYWNlKGAke2Nsc30gLSBzZW5kaW5nICR7bXNnfWApO1xuICAgIH1cblxuICAgIHRoaXMuaW9zUG9zdEFjY2Vzc2liaWxpdHlOb3RpZmljYXRpb24oJ2Fubm91bmNlbWVudCcsIG1zZyk7XG4gIH0pLFxuKTtcblxuVmlldy5wcm90b3R5cGVbYWNjZXNzaWJpbGl0eUxhYmVsUHJvcGVydHkuc2V0TmF0aXZlXSA9IHByb2ZpbGUoJ1ZpZXc8QTExWT4uYWNjZXNzaWJpbGl0eUxhYmVsU2V0TmF0aXZlJywgZnVuY3Rpb24gYWNjZXNzaWJpbGl0eUxhYmVsU2V0TmF0aXZlKFxuICB0aGlzOiBWaWV3LFxuICBsYWJlbDogc3RyaW5nLFxuKSB7XG4gIHVwZGF0ZUExMVlQcm9wZXJ0eSh0aGlzLCAnYWNjZXNzaWJpbGl0eUxhYmVsJywgbGFiZWwpO1xufSk7XG5cblZpZXcucHJvdG90eXBlW2FjY2Vzc2liaWxpdHlJZFByb3BlcnR5LnNldE5hdGl2ZV0gPSBwcm9maWxlKCdWaWV3PEExMVk+LmFjY2Vzc2liaWxpdHlJZGVudGlmaWVyU2V0TmF0aXZlJywgZnVuY3Rpb24gYWNjZXNzaWJpbGl0eUlkZW50aWZpZXJTZXROYXRpdmUoXG4gIHRoaXM6IFZpZXcsXG4gIGlkZW50aWZpZXI6IHN0cmluZyxcbikge1xuICB1cGRhdGVBMTFZUHJvcGVydHkodGhpcywgJ2FjY2Vzc2liaWxpdHlJZGVudGlmaWVyJywgaWRlbnRpZmllcik7XG59KTtcblxuVmlldy5wcm90b3R5cGVbYWNjZXNzaWJpbGl0eUxhbmd1YWdlUHJvcGVydHkuc2V0TmF0aXZlXSA9IHByb2ZpbGUoJ1ZpZXc8QTExWT4uYWNjZXNzaWJpbGl0eUxhbmd1YWdlU2V0TmF0aXZlJywgZnVuY3Rpb24gYWNjZXNzaWJpbGl0eUxhbmd1YWdlU2V0TmF0aXZlKFxuICB0aGlzOiBWaWV3LFxuICBsYW5nOiBzdHJpbmcsXG4pIHtcbiAgdXBkYXRlQTExWVByb3BlcnR5KHRoaXMsICdhY2Nlc3NpYmlsaXR5TGFuZ3VhZ2UnLCBsYW5nKTtcbn0pO1xuXG5WaWV3LnByb3RvdHlwZVthY2Nlc3NpYmlsaXR5SGludFByb3BlcnR5LnNldE5hdGl2ZV0gPSBwcm9maWxlKCdWaWV3PEExMVk+LmFjY2Vzc2liaWxpdHlIaW50U2V0TmF0aXZlJywgZnVuY3Rpb24gYWNjZXNzaWJpbGl0eUhpbnRTZXROYXRpdmUoXG4gIHRoaXM6IFZpZXcsXG4gIGhpbnQ6IHN0cmluZyxcbikge1xuICB1cGRhdGVBMTFZUHJvcGVydHkodGhpcywgJ2FjY2Vzc2liaWxpdHlIaW50JywgaGludCk7XG59KTtcblxuVmlldy5wcm90b3R5cGVbYWNjZXNzaWJpbGl0eU1lZGlhU2Vzc2lvbkNzc1Byb3BlcnR5LnNldE5hdGl2ZV0gPSBwcm9maWxlKFxuICAnVmlldzxBMTFZPi5hY2Nlc3NpYmlsaXR5TWVkaWFTZXNzaW9uU2V0TmF0aXZlJyxcbiAgZnVuY3Rpb24gYWNjZXNzaWJpbGl0eU1lZGlhU2Vzc2lvblNldE5hdGl2ZSh0aGlzOiBWaWV3KSB7XG4gICAgQWNjZXNzaWJpbGl0eUhlbHBlci51cGRhdGVBY2Nlc3NpYmlsaXR5UHJvcGVydGllcyh0aGlzKTtcbiAgfSxcbik7XG5cbnNldFZpZXdGdW5jdGlvbihcbiAgVmlldyxcbiAgY29tbW9uRnVuY3Rpb25zLmFjY2Vzc2liaWxpdHlTY3JlZW5DaGFuZ2VkLFxuICBwcm9maWxlKCdWaWV3PEExMVk+Li5hY2Nlc3NpYmlsaXR5U2NyZWVuQ2hhbmdlZCcsIGZ1bmN0aW9uIGFjY2Vzc2liaWxpdHlTY3JlZW5DaGFuZ2VkKHRoaXM6IFZpZXcpIHtcbiAgICB0aGlzLmlvc1Bvc3RBY2Nlc3NpYmlsaXR5Tm90aWZpY2F0aW9uKCdzY3JlZW4nKTtcbiAgfSksXG4pO1xuIl19